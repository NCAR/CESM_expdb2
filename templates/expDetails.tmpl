<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
        <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>
  <title>CESM2 Experiments Database</title>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
   <meta http-equiv="cache-control" content="max-age=0" />
   <meta http-equiv="cache-control" content="no-cache" />
   <meta http-equiv="expires" content="0" />
   <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
   <meta http-equiv="pragma" content="no-cache" />
   <meta name="description" content="CESM2 Experiments Database"/>
   <meta name="keywords"    content="CESM Software Engineering Working Group"/>
   <style type="text/css" media="screen">
     @import "/styles/cesm.css"; 
     @import "/styles/teststyles.css";
     @import "/svnuser/css/svnuser.css";
     @import "/jqueryui/development-bundle/demos/demos.css";
     @import "/jqueryui/css/redmond/jquery-ui-1.8.23.custom.css";
     @import "/jquerydt/DataTables-1.9.3/media/css/jquery.dataTables.css";
   </style>
   <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
   <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
   <script src="/jquery-validation/jquery.validate.js" language="javascript" type="text/javascript"></script>
   <script type="text/javascript" language="javascript" src="/scripts/jquery.dataTables.js"></script>
   <script type="text/javascript" src="/scripts/popitup.js"></script>
   <script type="text/javascript" src="/expdb2.0/scripts/exp_dashboard.js"></script>  
</head>

<body>
  <p>
    [% INCLUDE header.tmpl %]
  </p>

  <div class="body">
    <h1>[% case.casename %] - Experiment Detail</h1>

    <h2>CESM Case Working Title:</h2>
    <table>
      <tr>
	<td valign="top"><button onclick="return popitup('/expdb2.0/cgi-bin/caseTitle.cgi?case_id=[% case.case_id %]&action=update&expType_id=[% case.expType_id %]','height=200,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-pencil"></span></button></td>
	<td>[% case.title %]</td>
      </tr>
      <tr>
	<td colspan="2">
	  [% IF validstatus %]
	  <div id="msgbox" [% IF validstatus.status %] style="color:green" [% ELSE %] style="color:red" [% END %]>
	    [% validstatus.message %]
	  </div>
	</td>
      </tr>
    [% END %]
    </table>

    <br/>
    <a class="show-all-exp-details show-hide">show all</a>
    <br/>
    <br/>

    <div class="expDetail_accordion expDetail_applying">
      <div id="expDetail_accordion">

	[% IF expType.name == 'cmip6' %]
	<h3>[% case.expType_name %] Project Details</h3>
	<div id="expDetail_table">
	  <div class="left">
	    <table class="bordered">
	      <thead>
		<th colspan="2">CMIP6 Fields</th>
	      </thead>
	      <thead>
		<th>Field Name</th>		
		<th>Value</th>		
	      </thead>
	      [% FOREACH key IN project.keys.sort  %]
	      <tr>
		<td>[% key %]</td>
		<td>[% project.$key %]</td>
	      </tr>
	      [% END %]
	    </table>
	  </div>

	  <div class="right">
	    <table class="bordered">
	      <thead>
		<th colspan="2">CMIP6 File Global Attributes</th>
	      </thead>
	      <thead>
		<th>Field Name</th>		
		<th>Value</th>		
	      </thead>
	      [% FOREACH key IN globalAtts.keys.sort  %]
	      <tr>
		<td>[% key %]</td>
		<td>[% globalAtts.$key %]</td>
	      </tr>
	      [% END %]
	    </table>
	  </div>
	</div>
	[% END %]

	<h3>Case Workflow Process Status</h3>
	<div id="expDetail_table">
	  <table class="bordered">
	    <thead>
	      <th>Description</th>		
	      <th>Process Name</th>		
	      <th>Status</th>		
	      <th>Model Date</th>		
	      <th>Disk Usage</th>		
	      <th>Disk Path</th>		
	      <th>Last Update</th>		
	    </thead>
	    [% FOREACH key IN status.keys.sort %]
	    <tr>
	      <td>[% status.$key.description %]</td>
	      [% IF status.$key.code != 'Unknown' %]
	      <td><button onclick="return popitup('/expdb2.0/cgi-bin/showStats.cgi?case_id=[% case.case_id %]&processName=[% key %]','height=400,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-plus"></span></button> [% key %]</td>
	      [% ELSE %]
	      <td>[% key %]</td>
	      [% END %]
	      <td style="background-color:[% status.$key.color %]">[% status.$key.code %]</td>
	      <td>[% status.$key.model_date %]</td>
	      <td>[% status.$key.disk_usage %]</td>
	      <td>[% status.$key.disk_path %]</td>
	      <td>[% status.$key.last_update %]</td>
	    </tr>
	    [% END %]
	  </table>
	</div>

	<h3>Caseroot Settings</h3>
	<div id="expDetail_table">
	  <div class="left">
	    <table class="bordered">
	      <thead>
		<th colspan="2">Current Settings</th>
	      </thead>
	      <thead>
		<th>Variable Name</th>		
		<th>Current Value</th>		
	      </thead>
	      <tr>
		<td>Case Name (CASE):</td>
		<td>[% case.casename %]</td>
	      </tr>
	      <tr>
		<td>Caseroot (CASEROOT):</td>
		<td>[% case.caseroot %]</td>
	      </tr>
	      <tr>
		<td>SVN Caseroot Repository Link:</td>
		<td><a href="[% case.svn_repo_url %]" target="_blank">[% case.svn_repo_url %]</a></td>
	      </tr>
	      <tr>
		<td>Compiler (COMPILER):</td>
		<td>[% case.compiler %]</td>
	      </tr>
	      <tr>
		<td>Component Set (COMPSET):</td>
		<td>[% case.compset %]</td>
	      </tr>
	      <tr>
		<td>Short Term Archive Location (DOUT_S_ROOT):</td>
		<td>[% case.dout_s_root %]</td>
	      </tr>
	      <tr>
		<td>Project or Experiment Type:</td>
		<td>[% case.expType_name %] - [% case.expType_desc %]</td>
	      </tr>
	      <tr>
		<td>Grid (GRID):</td>
		<td>[% case.grid %]</td>
	      </tr>
	      <tr>
		<td>Job Queue (JOB_QUEUE):</td>
		<td>[% case.job_queue %]</td>
	      </tr>
	      <tr>
		<td>Job Wallclock Time (JOB_WALLCLOCK):</td>
		<td>[% case.job_time %]</td>
	      </tr>
	      <tr>
		<td>Machine (MACH):</td>
		<td>[% case.machine %]</td>
	      </tr>
	      <tr>
		<td>Model (MODEL):</td>
		<td>[% case.model %]</td>
	      </tr>
	      <tr>
		<td>Model Version (MODEL_VERSION):</td>
		<td>[% case.model_version %]</td>
	      </tr>
	      <tr>
		<td>MPI Library (MPILIB):</td>
		<td>[% case.mpilib %]</td>
	      </tr>
	      <tr>
		<td>Project (PROJECT):</td>
		<td>[% case.project %]</td>
	      </tr>
	      <tr>
		<td>Initial Archive Date:</td>
		<td>[% case.archive_date %]</td>
	      </tr>
	      <tr>
		<td>Restart Frequency (REST_N):</td>
		<td>[% case.rest_n %]</td>
	      </tr>
	      <tr>
		<td>Restart Option (REST_OPTION):</td>
		<td>[% case.rest_option %]</td>
	      </tr>
	      <tr>
		<td>Run Directory (RUNDIR):</td>
		<td>[% case.run_dir %]</td>
	      </tr>
	      <tr>
		<td>Run Reference Case (RUN_REFCASE):</td>
		<td>[% case.run_refcase %]</td>
	      </tr>
	      <tr>
		<td>Run Reference Date (RUN_REFDATE):</td>
		<td>[% case.run_refdate %]</td>
	      </tr>
	      <tr>
		<td>Run Start Date (RUN_STARTDATE):</td>
		<td>[% case.run_startdate %]</td>
	      </tr>
	      <tr>
		<td>Run Type (RUNTYPE):</td>
		<td>[% case.run_type %]</td>
	      </tr>
	      <tr>
		<td>Case User Name (USER):</td>
		<td>[% case.caseuser %]</td>
	      </tr>
	      <tr>
		<td>Stop Frequency (STOP_N):</td>
		<td>[% case.stop_n %]</td>
	      </tr>
	      <tr>
		<td>Stop Option (STOP_OPTION):</td>
		<td>[% case.stop_option %]</td>
	      </tr>
	    </table>
	  </div>

	  <div class="right">
	    <table>
	      <thead>
		<th colspan="3" align="center">Settings Change History</th>
	      </thead>
	      <thead>
		<th>Variable Name</th>		
		<th>Value History</th>		
		<th>Last Update</th>		
	      </thead>
	      [% FOREACH fn IN fields %]
	      [% FOREACH key IN fn.keys.sort %]
	      <tr>
		<td>[% fn.$key.field_name %]</td>
		<td>[% fn.$key.field_value %]</td>
		<td>[% fn.$key.last_update %]</td>
	      </tr>
	      [% END %]
	      [% END %]
	    </table>
	  </div>
	</div>

	<h3>Case Notes</h3>
	<div id="expDetail_table">
	  <table class="bordered">
	    <tr>
	      <td valign="top"> <button onclick="return popitup('/expdb2.0/cgi-bin/caseNotes.cgi?case_id=[% case.case_id %]&expType_id=[% case.expType_id %]','height=200,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-plus"></span></button> Case Notes:</td>
	      <td>
		<table>
		  <thead>
		    <th></th>		
		    <th>Note</th>		
		    <th>User</th>		
		    <th>Last Update</th>		
		  </thead>
		  [% FOREACH n IN notes %]
		  <tr>
		    <td valign="top"><button onclick="return popitup('/expdb2.0/cgi-bin/caseNotes.cgi?case_id=[% case.case_id %]&note_id=[% n.note_id %]&action=update&expType_id=[% case.expType_id %]','height=200,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-pencil"></span></button></td>
		    <td><pre>[% n.note %]</pre></td>
		    <td valign="top">[% n.firstname %] [% n.lastname %] ([% n.email %]) </td>
		    <td valign="top">[% n.last_update %]</td>
		  </tr>
		  [% END %]
		</table>
	      </td>
	    </tr>
	  </table>
	</div>

	<h3>Case Diagnostics and Climate Data Gateway Links</h3>
	<div id="expDetail_table">
	  <table class="bordered">
	    <tr>
	      <td valign="top"><button onclick="return popitup('/expdb2.0/cgi-bin/caseLinks.cgi?case_id=[% case.case_id %]&expType_id=[% case.expType_id %]','height=300,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-plus"></span></button> Case Links:</td>
	      <td>
		<table>
		  [% FOREACH lk IN links %]
		  <thead>
		    <th></th>
		    <th>Process</th>		
		    <th>Link Type</th>		
		    <th>Link</th>		
		    <th>Last Update</th>		
		  </thead>
		  <tr>
		    <td><button onclick="return popitup('/expdb2.0/cgi-bin/caseLinks.cgi?case_id=[% case.case_id %]&link_id=[% lk.link_id %]&action=update&expType_id=[% case.expType_id %]','height=300,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-pencil"></span></button></td>
		    <td>[% lk.process_name %]</td>
		    <td>[% lk.linkType_name %]</td>
		    [% http = lk.link %]
		    [% IF lk.linkType_id == 1 %]
		    <td><a href="[% lk.link %]" target="_blank">[% lk.link %]</a></td>
		    [% ELSE %]
		    <td>[% lk.link %]</td>
		    [% END %]
		    <td>[% lk.last_update %]</td>
		  </tr>
		  <tr>
		    <td colspan="5"><b>Description</b></td>
		  </tr>
		  <tr>
		    <td colspan="5">[% lk.description %]</td>
		  </tr>
		  [% END %]
		</table>
	      </td>
	    </tr>
	  </table>
	</div>

	<h3>Publication Options</h3>
	<div id="expDetail_table">
	  <p>* You must be the scientific lead or archiver for this experiment or a expdb2.0 admin in order to publish. After successful publication, it is up to the user to delete any intermediate files associated with this experiment on disk. <b>These publication steps are coming soon!</b></p>

	  <form action="/expdb2.0/cgi-bin/publishGCD.cgi?case_id=[% case.case_id %]">
	    <p><input type="checkbox" name="gcd_cb" onclick="if(this.checked){this.form.submit()}"> Publish to NCAR Climate Data Gateway (formally ESG).</input> This publishes the single-variable CESM compressed timeseries netCDF files.</p>
	  </form>

	  <form action="/expdb2.0/cgi-bin/publishESGF.cgi?case_id=[% case.case_id %]">
	    <p><input type="checkbox" name="gcd_cb" onclick="if(this.checked){this.form.submit()}"> Publish to ESGF.</input> This publishes the Conformed compressed timeseries netCDF files.</p>
	  </form>

	  <form action="/expdb2.0/cgi-bin/publishDSET.cgi?case_id=[% case.case_id %]&expType_id=[% case.expType_id %]">
	    <p><input type="checkbox" name="dset_cb" onclick="if(this.checked){this.form.submit()}"> Publish Experiment to CKAN/DSET.</input></p>
	  </form>

	  <form action="/expdb2.0/cgi-bin/publishScience.cgi?case_id=[% case.case_id %]">
	    <p><input type="checkbox" name="science_cb" onclick="if(this.checked){this.form.submit()}"> Publish to CESM Scientifically Validated web page.</input></p>
	  </form>

	  <form action="/expdb2.0/cgi-bin/publishScience.cgi?case_id=[% case.case_id %]">
	    <p><input type="checkbox" name="timing_cb" onclick="if(this.checked){this.form.submit()}"> Publish to CESM Timing web page.</input></p>
	  </form>
	</div>


      </div>
    </div>
  </div>
</body>
</html>


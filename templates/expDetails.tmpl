<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">	
    <title>CESM2 Experiment Details</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta name="description" content="CESM2 Experiment Database"/>
    <meta name="keywords"    content="CESM Software Engineering Working Group"/>

    <style type="text/css" media="screen">
      /*@import "/styles/cesm.css";
      @import "/styles/teststyles.css";
      @import "/svnuser/css/svnuser.css";
      @import "/jqueryui/development-bundle/demos/demos.css";
      @import "/jqueryui/css/redmond/jquery-ui-1.8.23.custom.css";
      @import "/jquerydt/DataTables-1.9.3/media/css/jquery.dataTables.css";*/
    </style>

    <style>
      #details { 
      background-color: #c5edcb; 
      }
      .alert:hover {
      cursor: pointer;
      }
      table {
      width: 100%;
      }
      .dtr-details {
      width: 100%;
      }
      table.dataTable tbody.tbody-timing td {
      padding: 0px;
      }
      #wrapper {
      display: block;
      }
    </style>

    [% INCLUDE 'modern/css/css-include.html' %]
    <style>
      [% INCLUDE 'modern/css/datatables.min.css' %]
      [% INCLUDE 'modern/skins/default.css' %]

      #inner-headline nav ul.dropdown-menu li a {
      color:#000;
      }

      .tab-content {
      border-left: 1px solid #ddd;
      border-right: 1px solid #ddd;
      border-bottom: 1px solid #ddd;
      }

      .tab-pane {

      }

      .nav-sub {
      padding: 10px;
      background-color: #3E6A9C;
      }

      .nav-sub > li > a {
      border-radius: 4px;
      color: #fff;
      }

      .nav-sub > li > a:hover {
      background-color:#fff;
      color: #000;
      }

      .tab-pane {
      /*min-height: 330px;*/
      }


      .panel-group .panel {
      border-radius: 0px;
      border-left: 0px;
      border-right: 0px;
      }

      .panel-group .panel + .panel {
      margin-top: 0px;
      }

      .panel-sub-buttons {
      float: right;
      margin-top: -50px;
      margin-right: 30px;
      }

      .modal-footer-sm {
      margin-top: 0px;
      padding: 5px 20px 5px 20px;
      }
    </style>
  </head>


  <body>
    <div id="wrapper">
      <header>
	<div class="navbar navbar-default navbar-static-top">
	  <div class="container">
	    [% INCLUDE 'modern/includes/header/navbar-header.html' %]
	    [% INCLUDE 'modern/includes/header/search.html' %]
	    [% INCLUDE 'modern/includes/header/nsf-header.html' %]
	    [% INCLUDE 'modern/includes/navigation/models-nav.html' %]
	  </div>
	</div>
      </header>

      <section id="inner-headline">
	<div class="container">
	  <div class="row">
	    <div class="col-lg-12">
	      <ul class="breadcrumb">
		<li><a href="http://www.cesm.ucar.edu/index.html"><i class="fa fa-home"></i></a><i class="icon-angle-right"></i></li>
		<li><a href="http://www.cesm.ucar.edu/models/">CESM Models</a><i class="icon-angle-right"></i></li>
		<li><a href="/">CSEG Web Apps</a><i class="icon-angle-right"></i></li>
		<li><a href="/expdb2.0">Experiment Database</a><i class="icon-angle-right"></i></li>
		<li class="active">Experiment Details</li>
	      </ul>

	      [% INCLUDE nav.tmpl %]
	    </div>
	  </div>
	</div>
      </section>


      <!-- content start -->
      <section id="content">
	<div class="container">
	  <div class="row visible-sm-block text-center hidden-md hidden-lg">
	    <h3>Not designed for mobile viewing, please open on a desktop</h3>
	  </div>


	  <div class="row hidden-sm hidden-xs">
	    <div class="col-lg-12">
	      <div class="post-image">
		<div class="post-heading">
		  <h1>CESM2 Experiment Details <small>- <em>[% case.casename.value %]</em></small></h1>
		</div>
	      </div>

	      <div class="">
		<p class="lead">The purpose of this project is to provide a single web portal to store metadata for CESM experiments including tracking run status, viewing diagnostics, and adding publication links.</p>
		<span class="label label-danger">* You must have a valid CESM SVN developers login or a UCAS login to use the experiment database</span>
	      </div>

	      <br>

	      <!--<h2>[% case.casename.value %] - Experiment Detail</h2>-->

	      <!-- main panel start -->
	      <div class="panel panel-default">
		<div class="panel-heading" style="padding: 15px;">
		  <h2 class="panel-title">CESM Case Working Title &amp; Details <button type="button" class="btn btn-default btn-sm btn-show-exp-details pull-right" style="margin-top: -7px;"><i class="fa fa-folder-open"></i>&nbsp;Toggle All Details</button></h2> 
		</div>
		<div class="panel-body">
		  [% IF validstatus.message %]
		  <div class="alert [% IF validstatus.status == 1 %] alert-success [% ELSE %] alert-danger [% END %] text-center" role="alert">
		    <span class="">[% validstatus.message %]</span>
		  </div>
		  [% END %]
		  <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModalTitle" style="margin-right: 15px;">
		    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
		  </button>[% case.title.value %]

		  <div class="modal fade" id="myModalTitle" tabindex="-1" role="dialog" aria-labelledby="myModalTitleLabel">
		    <div class="modal-dialog" role="document">
		      <div class="modal-content">
			<div class="modal-header">
			  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			  <h4 class="modal-title" id="myModalTitleLabel">Update a case title for [% case.casename.value %]</h4>
			</div>
			<form method="post">
			  <div class="modal-body">
			    <div class="form-group">
			      <textarea class="form-control" name="title" rows="5" maxlength="256" cols="100">[% case.title.value %]</textarea>
			    </div>
			  </div>
			  <div class="modal-footer">
			    <input type="hidden" name="action" value="updateTitleProc"/>
			    <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
			    <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
			    <button type="submit" class="btn btn-primary" id="btn-update" value="Update">Update</button>
			    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			  </div>
			</form>
		      </div>
		    </div>
		  </div>
		</div>

		<div id="accordion-details" class="panel-default">
		  [% IF expType.name == 'cmip6' %]
		  <!-- cmip6 sub panel start -->
		  <div class="panel-heading">
		    <h4 class="panel-title">
		      <a class="collapsed accordion-toggle" role="button" data-toggle="collapse" data-parent="#accordion-MIP" href="#CMIP6Collapse" aria-expanded="false" aria-controls="CMIP6Collapse">
			[% case.expType_name.value.upper %] Project Details
		      </a>
		    </h4>
		  </div>
		  <div id="CMIP6Collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="CMIP6Header">
		    <div class="panel-body">
		      <div class="row">
			<div class="col-lg-6">
			  <div class="alert alert-info text-center" role="alert"><strong>CMIP6 Fields</strong></div>
			  <table class="table table-striped table-condensed small" id="CMIP6Table">
			    <thead>
			      <th>Field Name</th>
			      <th>Value</th>
			    </thead>
			    <tbody>
			      [% FOREACH key IN project.keys.sort  %]
			      <tr>
				<td><strong>[% key %]</strong></td>
				<td>[% project.$key %]</td>
			      </tr>
			      [% END %]
			    </tbody>
			  </table>
			</div>

			<div class="col-lg-6">
			  <div class="alert alert-info text-center" role="alert">
			      <button type="button" class="btn btn-default btn-sm" data-toggle="modal" id="" data-target="#myModalCMIP6GlobalAtts">
				<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
			      </button>
			      <strong>CMIP6 File Global Attributes</strong></div>
			  <table class="table table-striped table-condensed small" id="CMIP6Table">
			    <thead>
			      <th>Field Name</th>
			      <th>Value</th>
			    </thead>
			    <tbody>
			      [% FOREACH key IN globalAtts.keys.sort  %]
			      <tr>
				<td><strong>[% key %]</strong></td>
				<td>[% globalAtts.$key %]</td>
			      </tr>
			      [% END %]
			    </tbody>
			  </table>
			</div>
		      </div>
		    </div>
		  </div>

		  <div class="modal fade" id="myModalCMIP6GlobalAtts" tabindex="-1" role="dialog" aria-labelledby="myModalCMIP6GlobalAttsLabel">
		    <div class="modal-dialog modal-lg" role="document">
		      <div class="modal-content">
			<div class="modal-header">
			  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			  <h4 class="modal-title" id="myModalCMIP6GlobalAttsLabel">Update CMIP6 File Global Attributes for [% case.casename.value %]</h4>
                          <span class="label label-default" style="word-wrap: break-word">* Caution - these values MUST match the global attributes defined in the <a target="_blank" href="https://github.com/WCRP-CMIP/CMIP6_CVs/blob/master/CMIP6_experiment_id.json">WRCP CMIP6 experiments controlled vocabulary JSON</a> specification.</span><br/>
			</div>

			<form id="updateGlobalAttsForm" method="POST">
			  <div class="modal-body">
			    <div class="form-group">
			      <br/>
			      [% IF case.is_ens.value.lower == 'true' %] 
			      <fieldset class="form-group">
				<label for="updateEnsembleGlobalAttsRadios1">Ensemble update options:</label><br/>
				<input type="radio" name="update_ensemble_globalAtts" id="updateEnsembleGlobalAttsRadios1" value="all" required/> Update *ALL* ensemble members preserving the variant label "r" value increment<br/>
				<input type="radio" name="update_ensemble_globalAtts" id="updateEnsembleGlobalAttsRadios1" value="one"/> Update *ONLY* this ensemble member perserving the variant label "r" value increment
			      </fieldset>
			      [% END %]

			      <br/>
			      <label>CMIP6 Variant Label (ripf) <small class="text-muted">(variant_label)</small></label>
			      <br/>
			      <input class="form-control" type="text" name="variant_label" maxlength="12" size="12" placeholder="[% globalAtts.variant_label %]" value="[% globalAtts.variant_label %]"/>
			      <br/>
			      <label>CMIP6 Branch Method <small class="text-muted">(branch_method)</small></label>
			      <br/>
			      <textarea class="form-control" name="branch_method" rows="3" maxlength="500" cols="64" placeholder="[% globalAtts.branch_method %]" value="[% globalAtts.branch_method %]"></textarea>
			      <p class="text-muted"><small><strong>Note:</strong> branch_method
				  examples: "perturbations to atmospheric fields were applied at the
				  branch time, followed by a 50 year spin-up period under control
				  conditions"; "fixed historical forcing from year 1850 was applied for
				  a 20 year spin-up period, after which the historically-evolving
				  forcing was imposed."  For a run that had not been spawned from a
				  parent, this attribute should be omitted or set to "no parent".  For
				  runs simply restarted from some point in the parent (without special
				  procedures applied), branch_method should be set to
				  "standard".</small></p>
			      <br/>
			      <label>CMIP6 Branch time in child <small class="text-muted">(branch_time_in_child - [% globalAtts.branch_time_in_child %])</small></label>
			      <br/>
			      <input class="form-control" type="text" name="branch_time_in_child" maxlength="10" size="12" placeholder="YYYY-MM-DD"/>
			      <br/>
			      <label>CMIP6 Parent Experiment - leave unselected if no parent exists <small class="text-muted">(parent_experiment_id)</small> </label>
			      <br>
			      <select name="parentExp">
				<option value="0">Select Experiment</option>
				[% FOREACH exp IN CMIP6Exps %]	
				<option value="[% exp.exp_id %]">[% exp.expName %] : [% exp.casename %]</option>
				[% END %]
			      </select>
			      <br/>
			      <br>
			      <label>CMIP6 Branch time in parent <small class="text-muted">(branch_time_in_parent - [% globalAtts.branch_time_in_parent %])</small></label>
			      <br>
			      <input class="form-control" type="text" name="branch_time_in_parent" maxlength="10" size="12"  placeholder="YYYY-MM-DD" />

			      <p class="text-muted"><small><strong>Note:</strong> For CESM, the branch_time_in_child value should be set to the CESM RUN_STARTDATE. The parent_time_in_parent can be set to the CESM RUN_REFDATE but only if the RUN_REFCASE is another CMIP6 experiment. If there is no CMIP6 Parent Experiment selected then the branch_time_in_parent should be left blank or set to "no parent". See Note 5 of the <a href="https://www.earthsystemcog.org/site_media/projects/wip/CMIP6_global_attributes_filenames_CVs_v6.2.6.pdf">CMIP6 Global Attributes, DRS, Filenames, Directory Structure, and CV's</a> for more details and examples. All CESM CMIP6 experiments use parent_time_units = "days since 0001-01-01 (no leap)"</small></p>
			    </div>

			    <div class="modal-footer">
			      <input type="hidden" name="action" value="updateGlobalAttsProc"/>
			      <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
			      <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
			      <input type="hidden" name="caseTitle" value="[% case.title.value %]"/>
			      <button type="submit" class="btn btn-primary"  id="btn-update" value="Submit">Update</button>
			      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			    </div>
			  </div>
			</form>
			
		      </div>
		    </div>
		  </div>

		  <!-- cmip6 sub panel end -->
		  [% END %]



		  <!-- Case Workflow Process Status sub panel start -->
		  <div class="panel-heading" role="tab" id="statusTableHeader">
		    <h4 class="panel-title">
		      <a class="collapsed accordion-toggle" role="button" data-toggle="collapse" data-parent="#accordion-MIP" href="#statusTableCollapse" aria-expanded="false" aria-controls="statusTableCollapse">
			Case Workflow Process Status
		      </a>
		    </h4>
		  </div>

		  <div id="statusTableCollapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="statusTableHeader">
		    <div class="panel-body">
		      <div class="panel-sub-buttons">
			<button type="button" class="btn btn-default btn-sm" id="statusBtn-show-all-children">
			  <i class="fa fa-folder-open"></i> Show All
			</button>

			<button type="button" class="btn btn-default btn-sm" id="statusBtn-hide-all-children">
			  <i class="fa fa-folder-open"></i> Hide All
			</button>
		      </div>

		      <table id="statusTable" class="table table-striped table-condensed small" width="100%">
			<thead>
			  <tr>
			    <th>Description</th>		
			    <th>Status</th>		
			    <th>Model Date</th>		
			    <th>Last Update</th>		
			    <th>Archive Method</th>
			    <th class="none"><span class="label label-warning" style="font-weight: bold; font-size: 13px;">Status History</span></th>
			  </tr>
			</thead>
			<tbody>
			  [% FOREACH key IN status.keys.sort %]
			  <tr>
			    <td>[% status.$key.description %]</td>
			    <td>
			      [% IF status.$key.code == "Succeeded" %]
			      <span class="label label-info">[% status.$key.code %]</span>
			      [% END %]
			      [% IF status.$key.code == "Unknown" %]
			      <span class="label label-default">[% status.$key.code %]</span>
			      [% END %]
			      [% IF status.$key.code == "Started" %]
			      <span class="label label-success">[% status.$key.code %]</span>
			      [% END %]
			      [% IF status.$key.code == "Failed" %]
			      <span class="label label-danger">[% status.$key.code %]</span>
			      [% END %]
			      [% IF status.$key.code == "Verified" %]
			      <span class="label label-danger">[% status.$key.code %]</span>
			      [% END %]
			    </td>
			    <td>[% IF status.$key.model_date %]<pre>[% status.$key.model_date %]</pre>[% END %]</td>
			    <td>[% status.$key.last_update %]</td>
			    <td>[% status.$key.archive_method %]</td>
			    <td>
			      <table class="table table-condensed table-striped table-bordered" width="100%" style="background-color: #f2f2f2;">
				<thead>
				  <tr id="">
				    <th>Status</th>		
				    <th>Process Name</th>		
				    <th>Model Date</th>		
				    <th>Disk Path</th>		
				    <th>Disk Usage</th>		
				    <th>Last Update</th>		
				    <th>Archive Method</th>
				  </tr>
				</thead>
				<tbody class="tbody-status">
				  [% FOREACH stat IN status.$key.history %]
				  [% IF stat.code %]
				  <tr class="tr-status">
				    <td>
				      [% IF stat.code == "Succeeded" %]
				      <span class="label label-info">[% stat.code %]</span>
				      [% END %]
				      [% IF stat.code == "Unknown" %]
				      <span class="label label-default">[% stat.code %]</span>
				      [% END %]
				      [% IF stat.code == "Started" %]
				      <span class="label label-success">[% stat.code %]</span>
				      [% END %]
				      [% IF stat.code == "Failed" %]
				      <span class="label label-danger">[% stat.code %]</span>
				      [% END %]
				      [% IF status.$key.code == "Verified" %]
				      <span class="label label-danger">[% status.$key.code %]</span>
				      [% END %]
				    </td>
				    <td>[% key %]</td>
				    <td>[% IF stat.model_date %]<pre>[% stat.model_date %]</pre>[% END %]</td>
				    <td>[% stat.disk_path %]</td>
				    <td class="bytes-convert" id="bytes-[% key %]-[% stat.disk_usage %]">[% stat.disk_usage %]</td>
				    <td>[% stat.last_update %]</td>
				    <td>[% stat.archive_method %]</td>
				  </tr>
				  [% END %]
				  [% END %]
				</tbody>
			      </table>
			    </td>
			  </tr>
			  [% END %]
			</tbody>
			<tfoot>
			  <tr>
			    <th>Description</th>		
			    <th>Status</th>		
			    <th>Model Date</th>		
			    <th>Last Update</th>		
			    <th>Archive Method</th>
			    <th class="none">Status History</th>
			  </tr>
			</tfoot>
		      </table>
		    </div>
		  </div>
		  <!-- Case Workflow Process Status sub panel end -->


		  <!-- Caseroot Settings sub panel start -->
		  <div class="panel-heading" role="tab" id="caseTableHeader">
		    <h4 class="panel-title">
		      <a class="collapsed accordion-toggle" role="button" data-toggle="collapse" data-parent="#accordion-MIP" href="#caseTableCollapse" aria-expanded="false" aria-controls="caseTableCollapse">
			Caseroot Settings
		      </a>
		    </h4>
		  </div>

		  <div id="caseTableCollapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="caseTableHeader">
		    <div class="panel-body">
		      <div class="panel-sub-buttons">
			<button type="button" class="btn btn-default btn-sm" id="caseBtn-show-all-children">
			  <i class="fa fa-folder-open"></i> Show All
			</button>

			<button type="button" class="btn btn-default btn-sm" id="caseBtn-hide-all-children">
			  <i class="fa fa-folder-open"></i> Hide All
			</button>
		      </div>

		      <table id="caseTable" class="table table-striped table-condensed" width="100%">
			<thead>
			  <tr>
			    <th>Case Field Name</th>		
			    <th>Field Value</th>		
			    <th class="none"><span class="label label-warning" style="font-weight: bold; font-size: 13px;">Change History</span></th>		
			  </tr>
			</thead>
			<tbody>
			  [% FOREACH key IN case.keys.sort %]
			  <tr>
			    <td>[% key %]</td>
			    [% IF key == "svn_repo_url"%]
			    <td><a href="[% case.$key.value %]" target="_blank">[% case.$key.value %]</a></td>
			    [% ELSE %]
			    <td>[% case.$key.value %]</td>
			    [% END %]
			    <td>
			      <table class="table table-condensed table-striped" width="100%" style="background-color: #f2f2f2;">
				<thead>
				  <tr id="">
				    <th>Field Value</th>
				    <th>Last Update</th>
				  </tr>
				</thead>
				<tbody>
				  [% FOREACH change IN case.$key.history %]
				  <tr>
				    <td>[% change.field_value %]</td>
				    <td>[% change.last_update %]</td>
				  </tr>
				  [% END %]
				</tbody>
			      </table>
			    </td>
			  </tr>
			  [% END %]
			</tbody>
			<tfoot>
			  <tr>
			    <th>Case Field Name</th>		
			    <th>Field Value</th>		
			    <th class="none">Change History</th>		
			  </tr>
			</tfoot>
		      </table>
		    </div>
		  </div>
		  <!-- Caseroot Settings sub panel end -->


		  <!-- Case Notes sub panel start -->
		  <div class="panel-heading" role="tab" id="caseNotesHeader">
		    <h4 class="panel-title">
		      <a class="collapsed accordion-toggle" role="button" data-toggle="collapse" data-parent="#accordion-MIP" href="#caseNotesCollapse" aria-expanded="false" aria-controls="caseNotesCollapse">
			Case Notes
		      </a>
		    </h4>
		  </div>

		  <div id="caseNotesCollapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="caseNotesHeader">
		    <div class="panel-body">
		      <div class="panel-sub-buttons">
			<button type="button" class="btn btn-default btn-sm" data-toggle="modal" id="" data-target="#myModalCaseNotes">
			  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add Case Note
			</button>
		      </div>

		      <div class="modal fade" id="myModalCaseNotes" tabindex="-1" role="dialog" aria-labelledby="myModalCaseNotesLabel">
			<div class="modal-dialog" role="document">
			  <div class="modal-content">
			    <div class="modal-header">
			      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			      <h4 class="modal-title" id="myModalCaseNotesLabel">Add a new case note for [% case.casename.value %]</h4>
			      <span class="label label-info">Text is formatted WYSIWYG. Please included carriage returns to fit within the text window.</span>
			    </div>

			    <form id="caseAddNoteForm" method="POST">
			      <div class="modal-body">
				<div class="form-group">
				  <textarea class="form-control" name="note" cols="100" rows="5"></textarea>
				</div>
			      </div>


			      <div class="modal-footer">
				<input type="hidden" name="action" value="addNoteProc"/>
				<input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				<input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				<button type="submit" class="btn btn-primary" id="btn-update" value="Submit">Submit</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			      </div>
			    </form>
			  </div>
			</div>
		      </div>

		      <table class="table table-condensed table-striped">
			<thead>
			  <th>Edit</th>		
			  <th>Note</th>		
			  <th>User</th>		
			  <th>Last Update</th>		
			</thead>
			<tbody>
			  [% FOREACH n IN notes %]
			  <tr>
			    <td>
			      <button type="button" class="btn btn-default btn-sm" data-toggle="modal" id="" data-target="#myModalCaseNote[% n.note_id %]">
				<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
			      </button>
			    </td>
			    <td><pre>[% n.note %]</pre></td>
			    <td>[% n.firstname %] [% n.lastname %] ([% n.email %]) </td>
			    <td>[% n.last_update %]</td>

			    <div class="modal fade" id="myModalCaseNote[% n.note_id %]" tabindex="-1" role="dialog" aria-labelledby="myModalCaseNote[% n.note_id %]Label">
			      <div class="modal-dialog" role="document">
				<div class="modal-content">
				  <div class="modal-header">
				    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				    <h4 class="modal-title" id="myModalCaseNote[% n.note_id %]Label">Update case note for [% case.casename.value %]</h4>
				    <span class="label label-info">Text is formatted WYSIWYG. Please included carriage returns to fit within the text window.</span>
				  </div>

				  <form id="updateNoteForm" method="POST">
				    <div class="modal-body">
				      <div class="form-group">
					<textarea class="form-control" name="note" cols="100" rows="5">[% n.note %]</textarea>
				      </div>

				      <input type="hidden" name="action" value="updateNoteProc"/>
				      <input type="hidden" name="note_id" value="[% n.note_id %]"/>
				      <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				      <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				      <button type="submit" class="btn btn-primary btn-block" id="btn-update" value="Submit">Submit</button>
				    </div>
				  </form>


				  <div class="modal-footer modal-footer-sm">
				    <form id="updateNoteForm" method="POST">
				      <input type="hidden" name="note_id" value="[% n.note_id %]"/>
				      <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				      <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				      <input type="hidden" name="action" value="deleteNoteProc"/>
				      <button type="submit" class="btn btn-danger" id="btn-update" value="Delete">Delete</button>
				      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				    </form>
				  </div>
				</div>
			      </div>
			    </div>
			  </tr>
			  [% END %]
			</tbody>
		      </table>
		    </div>
		  </div>
		  <!-- Case Notes sub panel end -->


		  <!-- Case Diag Links sub panel start -->
		  <div class="panel-heading" role="tab" id="caseLinksHeader">
		    <h4 class="panel-title">
		      <a class="collapsed accordion-toggle" role="button" data-toggle="collapse" data-parent="#accordion-MIP" href="#caseLinksCollapse" aria-expanded="false" aria-controls="caseLinksCollapse">
			Case Diagnostics, Process and Journal Publication Links
		      </a>
		    </h4>
		  </div>

		  <div id="caseLinksCollapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="caseLinksHeader">
		    <div class="panel-body">
		      <div class="panel-sub-buttons">
			<button type="button" class="btn btn-default btn-sm" data-toggle="modal" id="" data-target="#myModalCaseLinks">
			  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add Case Link
			</button>
		      </div>

		      <div class="modal fade" id="myModalCaseLinks" tabindex="-1" role="dialog" aria-labelledby="myModalCaseLinksLabel">
			<div class="modal-dialog" role="document">
			  <div class="modal-content">
			    <div class="modal-header">
			      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			      <h4 class="modal-title" id="myModalCaseLinksLabel">Add a new case link for [% case.casename.value %]</h4>
			    </div>

			    <form id="caseAddNoteForm" method="POST">
			      <div class="modal-body">
				<div class="form-group">
				  <label>Process</label>
				  <br>
				  <select name="processName">
				    <option value="">Select Process</option>
				    [% FOREACH p IN processes %]
				    <option value="[% p.process_id %]">[% p.description %] ([% p.process_name %])</option>
				    [% END %]
				  </select>
				</div>

				<div class="form-group">
				  <label>Link Type :&nbsp;</label>
				  [% FOREACH lt IN linkTypes %]
				  <label class="radio-inline" for="[% lt.linkType_id %]">
				    <input type="radio" name="linkType" id="" value="[% lt.linkType_id %]" id="[% lt.linkType_id %]"> [% lt.linkType_name %]
				  </label>
				  [% END %]
				</div>

				<div class="form-group">
				  <label>Link Value</label>
				  <textarea class="form-control" name="link" cols="100" rows="1"></textarea>
				</div>

				<div class="form-group">
				  <label>Description</label>
				  <textarea class="form-control" name="description" cols="100" rows="5"></textarea>
				</div>
			      </div>


			      <div class="modal-footer">
				<input type="hidden" name="action" value="addLinkProc"/>
				<input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				<input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				<button type="submit" class="btn btn-primary" id="btn-update" value="Submit">Submit</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			      </div>
			    </form>
			  </div>
			</div>
		      </div>

		      <table class="table table-striped table-condensed">
			<thead>
			  <th>Edit</th>
			  <th>Process</th>		
			  <th>Link Type</th>		
			  <th>Link</th>		
			  <th>Last Update</th>		
			</thead>
			[% FOREACH lk IN links %]
			<tr>
			  <td>
			    <button type="button" class="btn btn-default btn-sm" data-toggle="modal" id="" data-target="#myModalCaseLink[% lk.link_id %]">
			      <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
			    </button>
			  </td>
			  <td>[% lk.process_name %]</td>
			  <td>[% lk.linkType_name %]</td>
			  [% http = lk.link %]
			  [% IF lk.linkType_id == 1 %]
			  <td><a href="[% lk.link %]" target="_blank">[% lk.link %]</a></td>
			  [% ELSE %]
			  <td>[% lk.link %]</td>
			  [% END %]
			  <td>[% lk.last_update %]</td>
			</tr>

			
			<tr>
			  <td colspan="4">
			    <div style="padding-left: 15px; padding-bottom: 15px;">
			      <h6 class="clear-marginbot alert-success" style="margin-top: 0px;">Description</h6>
			      [% IF lk.description %]
			      [% lk.description %]
			      [% ELSE %]
			      n/a
			      [% END %]
			    </div>
			  </td>
			  <td>
			    <div style="padding-left: 15px; padding-bottom: 15px;">
			      <h6 class="clear-marginbot alert-success" style="margin-top: 0px;">User</h6>
			      [% IF lk.firstname %]
			      [% lk.firstname %] [% lk.lastname %] ([% lk.email %])
			      [% ELSE %]
			      n/a
			      [% END %]
			    </div>
			  </td>
			</tr>

			<div class="modal fade" id="myModalCaseLink[% lk.link_id %]" tabindex="-1" role="dialog" aria-labelledby="myModalCaseLink[% lk.link_id %]Label">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalCaseLink[% lk.link_id %]Label">Update case link for [% case.casename.value %]</h4>
			      </div>

			      <form id="" method="POST">
				<div class="modal-body">
				  <div class="form-group">
				    <label>Process</label>
				    <br>
				    <select name="processName">
				      <option value="">Select Process</option>
				      [% FOREACH p IN processes %]
				      [% IF p.process_id == lk.process_id %]
				      <option value="[% p.process_id %]" selected="selected">[% p.process_name %] - [% p.description %]</option>
				      [% ELSE %]
				      <option value="[% p.process_id %]">[% p.process_name %] - [% p.description %]</option>
				      [% END %]
				      [% END %]
				    </select>
				  </div>

				  <div class="form-group">
				    <label>Link Type :&nbsp;</label>
				    [% FOREACH lt IN linkTypes %]
				    <label class="radio-inline" for="[% lt.linkType_id %]">
				      [% IF lt.linkType_id == lk.linkType_id %]
				      <input type="radio" name="linkType" value="[% lt.linkType_id %]" id="[% lt.linkType_id %]" checked="checked"/>[% lt.linkType_name %]
				      [% ELSE %]
				      <input type="radio" name="linkType" value="[% lt.linkType_id %]" id="[% lt.linkType_id %]"/>[% lt.linkType_name %]
				      [% END %]
				    </label>
				    [% END %]
				  </div>

				  <div class="form-group">
				    <label>Link Value</label>
				    <textarea class="form-control" name="link" cols="100" rows="1">[% lk.link %]</textarea>
				  </div>

				  <div class="form-group">
				    <label>Description</label>
				    <textarea class="form-control" name="description" cols="100" rows="5">[% lk.description %]</textarea>
				  </div>

				  <input type="hidden" name="action" value="updateLinkProc"/>
				  <input type="hidden" name="link_id" value="[% lk.link_id %]"/>
				  <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				  <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				  <button type="submit" class="btn btn-primary btn-block" id="btn-update" value="Update">Update</button>
				</div>
			      </form>


			      <div class="modal-footer modal-footer-sm">
				<form id="" method="POST">
				  <input type="hidden" name="action" value="deleteLinkProc"/>
				  <input type="hidden" name="link_id" value="[% lk.link_id %]"/>
				  <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				  <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				  <button type="submit" class="btn btn-danger" id="btn-update" value="Delete">Delete</button>
				  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</form>
			      </div>
			    </div>
			  </div>
			</div>
			[% END %]
		      </table>
		    </div>
		  </div>
		  <!-- Case Diag Links sub panel end -->


		  <!-- Publication Options sub panel start -->
		  <div class="panel-heading" role="tab" id="publicationsHeader">
		    <h4 class="panel-title">
		      <a class="collapsed accordion-toggle" role="button" data-toggle="collapse" data-parent="#accordion-MIP" href="#publicationsCollapse" aria-expanded="false" aria-controls="publicationsCollapse">
			Data Publication Options
		      </a>
		    </h4>
		  </div>

		  <div id="publicationsCollapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="publicationsHeader">
		    <div class="panel-body">
		      <p class="small text-center">* You must be the
		      scientific lead or archiver for this experiment
		      or a expdb data manager in order to publish. After
		      successful publication, it is up to the user to
		      delete any intermediate files associated with
		      this experiment on disk. <b>Remember to add all links to
		      publication sources under the "Case Diagnostics and Publication Links" accordion above
		      or when updating the publication status.</b>
		      </p>

		      <br>

		      <ul class="list-group">
			<li class="list-group-item">
			  <p>Publish the Conformed compressed timeseries netCDF files to the ESGF.
			    Data managers can update the publication status using the <em>Update Status of ESGF button</em></p>

			  <div class="btn-group" role="group">
			    [% pubkey = 'publish_esgf'; IF status.$pubkey.code != "Started" && status.$pubkey.code != "Verified" %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalESGF">
			    [% ELSE %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalESGF" disabled>
			    [% END %]
			      Publish Request to ESGF
			    </button>
			  </div>

			  <div class="btn-group" role="group">
			    [% pubkey = 'publish_esgf'; IF status.$pubkey.code != "Verified" %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target=".ESGF-modal-lg">
			    [% ELSE %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target=".ESGF-modal-lg" disabled>
			    [% END %]
			      Update Status of ESGF
			    </button>
			  </div>

			  <div class="modal fade" id="myModalESGF" tabindex="-1" role="dialog" aria-labelledby="myModalESGFLabel">
			    <div class="modal-dialog" role="document">
			      <div class="modal-content">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				  <h4 class="modal-title" id="myModalESGFLabel">[% case.casename.value %] Publish to ESGF</h4>
				  <p>The following email requesting publication to the ESGF will be sent. Data managers can update the
				    publication status clicking on the "Update Status of ESGF" button.</p>
				</div>
				<form method="post">
				  <div class="modal-body">
				    <fieldset class="form-group">
				      <label for="publishEnsembleESGFRadios1">Ensemble publication options:</label><br/>
				      <input type="radio" name="pub_ensemble_ESGF" id="publishEnsembleESGFRadios1" value="all" required/> Publish *ALL* experiment ensemble members<br/>
				      <input type="radio" name="pub_ensemble_ESGF" id="publishEnsembleESGFRadios1" value="one"/> Publish *ONLY* this experiment
				    </fieldset>
				    <br/>
<pre>
email address: gateway-publish@ucar.edu
email subject: CESM EXDB ESGF Publication Notification: [% case.case_id.value %]
email body:

CESM EXDB ESGF Publication Notification
Case_ID: [% case.case_id.value %]
Path:  /glade/collections/cdg/cmip6/[% case.case_id.value %]
</pre>
				  </div>
                                  <div class="modal-footer">
				    <input type="hidden" name="action" value="publishESGFProcess"/>
				    <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				    <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				    <button type="submit" class="btn btn-primary" id="btn-update" value="Update">Send Email</button>
				    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				  </div>
				</form>
			      </div>
			    </div>
			  </div>

			  <div class="modal fade ESGF-modal-lg" id="myModalESGFStatus" tabindex="-1" role="dialog" aria-labelledby="myModalESGFStatusLabel">
			    <div class="modal-dialog modal-lg" role="document">
			      <div class="modal-content">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				  <h4 class="modal-title" id="myModalESGFStatusLabel">[% case.casename.value %] Update Status of ESGF</h4>
				  <p>Only data managers can update the ESGF publication status. ESGF Dataset DOI should be added under the
				    <b>Case Diagnostics and Publication Links</b> accordion.</p>
				</div>

				<form method="post">
				  <div class="modal-body container-fluid">
				    <div class="row">
				      <div class="col-lg-12">
					<fieldset class="form-group">
					  <label class="col-form-label col-lg-12">Successfully published and verified on ESGF?</label>
					  <input type="radio" name="verify_ensemble_ESGF" id="verifyEnsembleESGFRadios1" value="all" required/> *ALL* experiment ensemble members published and verified<br/>
					  <input type="radio" name="verify_ensemble_ESGF" id="verifyEnsembleESGFRadios1" value="one"/> *ONLY* this experiment published and verified
					</fieldset>
				      </div>
				    </div>

				    <fieldset class="form-group">
				      <div class="row">
					<label class="col-form-label col-lg-12">Published dataset URL?</label>
					<div class="col-lg-12">
					  <textarea class="form-control" name="esgf_url" cols="100" rows="3" placeholder="https://esgf-node.llnl.gov/search/cmip6/?institution_id=NCAR&source_id=[% globalAtts.source_id %]&experiment_id=[% globalAtts.experiment_id %]&variant_label=[% globalAtts.variant_label %]" required>https://esgf-node.llnl.gov/search/cmip6/?institution_id=NCAR&source_id=[% globalAtts.source_id %]&experiment_id=[% globalAtts.experiment_id %]&variant_label=[% globalAtts.variant_label %]</textarea>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<label class="col-form-label col-lg-12">Published dataset size in MB (for ensembles, enter dataset size of only one member)?</label>
					<div class="col-lg-4">
					  <input type="number" class="form-control" name="esgf_size" min="1" max="999999999" value=[% pubkey = 'publish_esgf'; status.$pubkey.disk_usage %] required/>
					</div>
				      </div>
				    </fieldset>
				    
				    <div class="modal-footer">
				      <input type="hidden" name="action" value="updateESGFProcess"/>
				      <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				      <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				      <button type="submit" class="btn btn-primary" id="btn-update" value="Update">Update</button>
				      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				    </div>
				  </div>
				</form>
			      </div>
			    </div>
			  </div>
			</li>

			<li class="list-group-item">
			  Publish to NCAR Climate Data Gateway (formally ESG). This publishes the single-variable CESM compressed timeseries netCDF files.
			  Data managers can update the publication status using the <em>Update Status of CDG button</em>.<br/>

			  <div class="btn-group" role="group">
			    [% pubkey = 'publish_cdg'; IF status.$pubkey.code != "Started" && status.$pubkey.code != "Verified" %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalCDG">
			    [% ELSE %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalCDG" disabled>
			    [% END %]
			      Publish Request to CDG
			    </button>
			  </div>

			  <div class="btn-group" role="group">
			    [% pubkey = 'publish_cdg'; IF status.$pubkey.code != "Verified" %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalCDGStatus">
			    [% ELSE %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalCDGStatus" disabled>
			    [% END %]
			      Update Status of CDG
			    </button>
			  </div>

			  <div class="modal fade" id="myModalCDG" tabindex="-1" role="dialog" aria-labelledby="myModalCDGLabel">
			    <div class="modal-dialog modal-lg" role="document">
			      <div class="modal-content">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				  <h4 class="modal-title" id="myModalCDGLabel">[% case.casename.value %] Publish to CDG</h4>
				  <p>The following email requesting publication to the CDG will be sent. Data managers can update the
				    publication status using the Update Status of CDG button.</p>
				</div>
				<form method="post">
				  <div class="modal-body">
				    [% IF case.is_ens.value.lower == 'true' %] 
				    <fieldset class="form-group">
				      <label for="publishEnsembleCDGRadios1">Ensemble publication options:</label><br/>
				      <input type="radio" name="pub_ensemble_CDG" id="publishEnsembleCDGRadios1" value="all" required/> Publish *ALL* ensemble members<br/>
				      <input type="radio" name="pub_ensemble_CDG" id="publishEnsembleCDGRadios1" value="one"/> Publish *ONLY* this ensemble member
				    </fieldset>
				    [% END %]
				  <br/>
<pre>
email address: gateway-publish@ucar.edu
email subject: CESM EXDB CDG Publication Notification: [% case.casename.value %]
email body:

CESM EXDB CDG Publication Notification
Casename: [% case.casename.value %]
Path:  /glade/collections/cdg/[% case.casename.value %]
</pre>
				  </div>
				  <div class="modal-footer">
				    <input type="hidden" name="action" value="publishCDGProcess"/>
				    <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				    <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				    <button type="submit" class="btn btn-primary" id="btn-update" value="Update">Send Email</button>
				    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				  </div>
				</form>
			      </div>
			    </div>
			  </div>

			  <div class="modal fade" id="myModalCDGStatus" tabindex="-1" role="dialog" aria-labelledby="myModalCDGStatusLabel">
			    <div class="modal-dialog modal-lg" role="document">
			      <div class="modal-content">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				  <h4 class="modal-title" id="myModalCDGStatusLabel">[% case.casename.value %] Update Status of CDG</h4>
				  <p>Only data managers can update the CDG publication status. CDG Dataset DOI should be added under the
				    <b>Case Diagnostics and Publication Links</b> accordion.</p>
				</div>

				<form method="post">
				  <div class="modal-body container-fluid">
				    <div class="row">
				      <div class="col-lg-12">
					<fieldset class="form-group">
					  <label for="verifyEnsembleCDGRadios1">Successfully published and verified on CDG?</label><br/>
					  <input type="radio" name="verify_ensemble_CDG" id="verifyEnsembleCDGRadios1" value="all" required/> *ALL* experiment ensemble members published and verified<br/>
					  <input type="radio" name="verify_ensemble_CDG" id="verifyEnsembleCDGRadios1" value="one"/> *ONLY* this experiment published and verified
					</fieldset>
				      </div>
				    </div>

				    <fieldset class="form-group">
				      <div class="row">
					<label class="col-form-label col-lg-12">Published dataset URL?</label>
					<div class="col-lg-12">
					  <textarea class="form-control" name="cdg_url" cols="100" rows="3" placeholder="https://www.earthsystemgrid.org/dataset/[% case.casename.value %]">https://www.earthsystemgrid.org/dataset/[% case.casename.value %]</textarea>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<label class="col-form-label col-lg-12">Published dataset size in MB (for ensembles, enter dataset size of only one member)?</label>
					<div class="col-lg-4">
					  <input type="number" class="form-control" name="cdg_size" min="1" max="999999999"  value=[% pubkey = 'publish_cdg'; status.$pubkey.disk_usage %] required/>
					</div>
				      </div>
				    </fieldset>

				    <div class="modal-footer">
				      <input type="hidden" name="action" value="updateCDGProcess"/>
				      <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				      <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				      <button type="submit" class="btn btn-primary"  id="btn-update" value="Update">Update</button>
				      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				    </div>
				  </div>
				</form>
			      </div>
			    </div>
			  </div>
			</li>

			<li class="list-group-item">
			  <span class="label label-danger" style="font-weight: 100; font-size: 85%;"><strong>Note:</strong> DASH publication options are still a work-in-progress.</span><br/>
			  Publish experiment metadata to the NCAR <a href="https://data.ucar.edu/" target="_blank">Digital Assets Services Hub</a>.
			  This also adds a link to the CESM2 scientifically supported configurations pages (link here).<br/>
			  <div class="btn-group" role="group">
			    [% pubkey = 'publish_dash'; IF status.$pubkey.code_id < 2 %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalDASH">
			    [% ELSE %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalDASH" disabled>
			    [% END %]
			    Add Keywords for DASH
			    </button>
			  </div>

			  <div class="btn-group" role="group">
			    [% pubkey = 'publish_dash'; IF status.$pubkey.code_id < 3 %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalDASHPub">
			    [% ELSE %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalDASHPub" disabled>
			    [% END %]
			    Preview and Publish to DASH
			    </button>
			  </div>

			  <div class="btn-group" role="group">
			    [% pubkey = 'publish_dash'; IF status.$pubkey.code_id < 6 %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalDASHStatus">
			    [% ELSE %]
			    <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModalDASHStatus" disabled>
			    [% END %]
			    Update Status of DASH
			    </button>
			  </div>

			  <div class="modal fade" id="myModalDASH" tabindex="-1" role="dialog" aria-labelledby="myModalDASHLabel">
			    <div class="modal-dialog modal-md" role="document">
			      <div class="modal-content">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				  <h4 class="modal-title" id="myModalDASHLabel">Add/Update [% case.casename.value %] metadata to the Digital Assest Services Hub</h4>
				  <p>The publication back-end script will gather as much information from existing database fields that have already been
				    defined. This form includes additional expert user knowledge that is required and cannot be harvested from existing database fields.
				    Use the Cntl and Shift keys to select multiple entries within a keyword select group. Be sure to scroll to the bottom of the form and press the "Submit" button.</p>
				</div>
				<form method="post">
				  <div class="modal-body">
				    <div class="row">
				      <div class="col-md-12">
					<fieldset class="form-group">
					  <label for="publishEnsembleDASHRadios1">DASH publication options:</label><br/>
					  <input type="radio" name="pub_ensemble_DASH" id="publishEnsembleDASHRadios1" value="all" required/> Publish *ALL* experiment ensemble members under this single DASH record<br/>
					  <input type="radio" name="pub_ensemble_DASH" id="publishEnsembleDASHRadios1" value="one"/> Publish *ONLY* this experiment member
					</fieldset>
				      </div>
				    </div>

				    <fieldset class="form-group">
				      <div class="row">
					<label class="col-form-label col-lg-12">Published dataset size in MB (for ensembles, enter dataset size of only one member)?</label>
					<div class="col-lg-4">
					  <input type="number" class="form-control" name="dash_size" min="1" max="999999999"  value=[% pubkey = 'publish_dash'; status.$pubkey.disk_usage %] required/>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <label for="atmlat_spatialResolution">Spatial resolution for atmosphere/land grid in degrees</label><br/>
				      <div class="row">
					<div class="col-md-6">
					  Latitude: <input id="atmlat_spatialResolution" class="form-control" name="atmlat_spatialResolution" size="5" maxlength="5" required/>
					</div>
					<div class="col-md-6">
					  Longitude: <input id="atmlon_spatialResolution" class="form-control" name="atmlon_spatialResolution" size="5" maxlength="5" required/>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <label for="ocnlat_spatialResolution">Spatial resolution for ocean/sea-ice grid in degrees</label><br/>
				      <div class="row">
					<div class="col-md-6">
					  Latitude: <input id="ocnlat_spatialResolution" class="form-control" name="ocnlat_spatialResolution" size="5" maxlength="5" required/>
					</div>
					<div class="col-md-6">
					  Longitude: <input id="ocnlon_spatialResolution" class="form-control" name="ocnlon_spatialResolution" size="5" maxlength="5" required/>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<div class="col-md-12">
					  <label for="horizontalResolution">Horizontal Resolution in layman's terms</label>
					  <select multiple class="form-control" id="horizontalResolution" name="horizontalResolution">
					    [% FOREACH hr IN horizontalResolutions %]
					    <option value="[% hr.id %]">[% hr.name %]</option>
					    [% END %]
					  </select>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<div class="col-md-12">
					  <label for="temporalResolution">Temporal Resolution - Select the temporal resolution(s) at with the output are available.
					    Some temporal resolutions need not be available for all variables for all years.</label>
					  <select multiple class="form-control" id="temporalResolution" name="temporalResolution">
					    [% FOREACH tr IN temporalResolutions %]
					    <option value="[% tr.id %]">[% tr.name %]</option>
					    [% END %]
					  </select>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<div class="col-md-12">
					  <label for="expAttributes">Experiment Attributes (Optional)</label>
					  <select multiple class="form-control" id="expAttributes" name="expAttributes">
					    [% FOREACH ea IN expAttributes %]
					    <option value="[% ea.id %]">[% ea.name %] ([% ea.short_name %])</option>
					    [% END %]
					  </select>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<div class="col-md-12">
					  <label for="expTypes">Experiment Type (select at least one)</label>
					  <select multiple class="form-control" id="expTypes" name="expTypes">
					    [% FOREACH et IN expTypes %]
					    <option value="[% et.id %]">[% et.name %]</option>
					    [% END %]
					  </select>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<div class="col-md-12">
					  <label for="expPeriods">Experiment Time Period (select at least one)</label>
					  <select multiple class="form-control" id="expPeriods" name="expPeriods">
					    [% FOREACH ep IN expPeriods %]
					    <option value="[% ep.id %]">[% ep.name %]</option>
					    [% END %]
					  </select>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<div class="col-md-12">
					  <label for="components">Stand-alone Components - If any of the CESM component models were run as 
					    uncoupled 'stand-alone' models for this experiment, select them here. (Optional)</label>
					  <select multiple class="form-control" id="components" name="components">
					    [% FOREACH c IN components %]
					    <option value="[% c.id %]"> [% c.name %] ([% c.short_name %])</option>
					    [% END %]
					  </select>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<div class="col-md-12">
					  <label for="wgs">
					    If the experiment is sponsored by a working group, select the group name(s) here. (Optional)</label>
					  <select multiple class="form-control" id="wgs" name="wgs">
					    [% FOREACH w IN wgs %]
					    <option value="[% w.id %]"> [% w.name %]</option>
					    [% END %]
					  </select>
					</div>
				      </div>
				    </fieldset>

				  </div>
				  <div class="modal-footer">
				    <input type="hidden" name="action" value="addDASHProcess"/>
				    <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				    <button type="submit" class="btn btn-primary" id="btn-update" value="Submit">Submit</button>
				    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				  </div>
				</form>
			      </div>
			    </div>
			  </div>


			  <div class="modal fade" id="myModalDASHPub" tabindex="-1" role="dialog" aria-labelledby="myModalDASHPubLabel">
			    <div class="modal-dialog modal-lg" role="document">
			      <div class="modal-content">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				  <h4 class="modal-title" id="myModalDASHLabel">Preview and Publish [% case.casename.value %] metadata to the Digital Assest Services Hub</h4>
				  <p>Below are the metadata fields specific to this experiment that will be published to DASH via an ISO XML record and the CKAN github repository. Check the keyword fields and then scroll to the bottom of the form and press either the "Publish" button to publish this record or the "Reset" button which will allow you to return to the keyword entry form and resubmit any changes..</p>
				</div>
				<form id="publishDASH_form" method="post">
				  <div class="modal-body">
				    <table class="table table-striped table-condensed">
				      <thead>
					<tr>
					  <th>JSON to ISO XML tagname</th>
					  <th>Value</th>
					</tr>
				      </thead>
				      <tbody>
					[% FOREACH key IN DASHFields.keys.sort  %]
					<tr>
					  <td><strong>[% key %]</strong></td>
					  <td>[% DASHFields.$key %]</td>
					</tr>
					[% END %]
				      </tbody>
				    </table>
				  </div>

				  <div class="modal-footer">
				    <input type="hidden" name="action" id="action"/>
				    <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				    <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				    <button type="submit" class="btn btn-primary" id="btn-publish" value="Publish" onclick="publishDASH_clickHandler(event);">Publish</button>
				    <button type="submit" class="btn btn-primary" id="btn-reset" value="Reset" onclick="resetDASH_clickHandler(event);">Reset</button>
				    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				  </div>
				</form>
			      </div>
			    </div>
			  </div>

			  <div class="modal fade" id="myModalDASHStatus" tabindex="-1" role="dialog" aria-labelledby="myModalDASHStatusLabel">
			    <div class="modal-dialog modal-lg" role="document">
			      <div class="modal-content">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				  <h4 class="modal-title" id="myModalDASHStatusLabel">[% case.casename.value %] Update Status of DASH</h4>
				  <p>Only data managers can update the DASH publication status. DASH landing page URLs and Dataset DOI should be added under the
				    <b>Case Diagnostics and Publication Links</b> accordion.</p>
				</div>

				<form method="post">
				  <div class="modal-body">
				    <div class="row">
				      <div class="col-lg-12">
					[% IF case.is_ens.value.lower == 'true' %] 
					<fieldset class="form-group">
					  <label for="verifyEnsembleDASHRadios1">Ensemble successfully published and verified options:</label><br/>
					  <input type="radio" name="verify_ensemble_DASH" id="verifyEnsembleDASHRadios1" value="all" required/> *ALL* ensemble members published and verified?<br/>
					  <input type="radio" name="verify_ensemble_DASH" id="verifyEnsembleDASHRadios1" value="one"/> *ONLY* this ensemble member published and verified?
					</fieldset>
					[% END %]
				      </div>
				    </div>

				    <fieldset class="form-group">
				      <div class="row">
					<label class="col-form-label col-lg-4">Successfully published and verified on DASH?</label>
					<div class="col-lg-8">
					  <div class="form-check">
					    [% pubkey = 'publish_dash'; IF status.$pubkey.code == "Succeeded" %]
					    <input class="form-check-input" type="radio" name="dash_published" id="publishDASHRadios1" value="no" disabled>
					    [% ELSE %]
					    <input class="form-check-input" type="radio" name="dash_published" id="publishDASHRadios1" value="no" checked>
					    [% END %]
					    <label class="form-check-label" for="publishDASHRadios1"> 
					      No
					    </label>
					  </div>
					  <div class="form-check">
					    [% pubkey = 'publish_dash'; IF status.$pubkey.code == "Succeeded" %]
					    <input class="form-check-input" type="radio" name="dash_published" id="publishDASHRadios2" value="yes" checked disabled>
					    [% ELSE %]
					    <input class="form-check-input" type="radio" name="dash_published" id="publishDASHRadios2" value="yes">
					    [% END %]
					    <label class="form-check-label" for="publishDASHRadios2">
					      Yes
					    </label>
					  </div>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<label class="col-form-label col-lg-12">Published dataset URL?</label>
					<div class="col-lg-12">
					  <textarea class="form-control" name="dash_url" cols="100" rows="3" placeholder="https://data.ucar.edu/dataset/[% title = case.title.value; title.replace('\s+', '-') %]">https://data.ucar.edu/dataset/[% title = case.title.value; title.replace('\s+', '-') %]</textarea>
					</div>
				      </div>
				    </fieldset>

				    <fieldset class="form-group">
				      <div class="row">
					<label class="col-form-label col-lg-12">Published dataset size in MB (for ensembles, enter dataset size of only one member)?</label>
					<div class="col-lg-4">
					  <input type="number" class="form-control" name="dash_size" min="1" max="999999999"  value=[% pubkey = 'publish_dash'; status.$pubkey.disk_usage %] required/>
					</div>
				      </div>
				    </fieldset>

				    <div class="modal-footer">
				      <input type="hidden" name="action" value="updateDASHProcess"/>
				      <input type="hidden" name="case_id" value="[% case.case_id.value %]"/>
				      <input type="hidden" name="expType_id" value="[% case.expType_id.value %]"/>
				      <button type="submit" class="btn btn-primary"  id="btn-update" value="Update">Update</button>
				      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				    </div>
				  </div>
				</form>
			      </div>
			    </div>
			  </div>

			</li>

		      </ul>
		    </div>
		  </div>
		  <!-- Publication Options sub panel end -->
		</div>
	      </div>
	      <!-- main panel end -->
	    </div>
	  </div>
	</div>
      </section>
      <!-- content end -->

      <!-- footer start -->
      <footer>        
	[% INCLUDE 'modern/includes/footer/footer-inc.html' %]
      </footer>
      <!-- footer end -->


      <!-- scroll to top arrow -->
      <a href="#" class="scrollup"><i class="fa fa-angle-up active"></i></a>


      <!-- js start -->
      [% INCLUDE 'modern/js/js-include.html' %]
      <script>
	[% INCLUDE 'modern/js/datatables.min.js' %]

	var statusTable = $('#statusTable').DataTable({
	"responsive": true,
	"lengthMenu": [ [25, 50, -1], [25, 50, "All"] ],
	"order": [ [ 0, 'asc'] ]
	});

	// Handle click on "Expand All" button
	$('button#statusBtn-show-all-children').on('click', function(){
	// Expand row details
	statusTable.rows(':not(.parent)').nodes().to$().find('td:first-child').trigger('click');
	});

	// Handle click on "Collapse All" button
	$('button#statusBtn-hide-all-children').on('click', function(){
	// Collapse row details
	statusTable.rows('.parent').nodes().to$().find('td:first-child').trigger('click');
	});

	var caseTable = $('#caseTable').DataTable( {
	"responsive": true,
	"lengthMenu": [ [-1, 25, 50], ["All", 25, 50] ],
	"order": [ [ 0, 'asc'] ]
	} );

	// Handle click on "Expand All" button
	$('button#caseBtn-show-all-children').on('click', function(){
	// Expand row details
	caseTable.rows(':not(.parent)').nodes().to$().find('td:first-child').trigger('click');
	});

	// Handle click on "Collapse All" button
	$('button#caseBtn-hide-all-children').on('click', function(){
	// Collapse row details
	caseTable.rows('.parent').nodes().to$().find('td:first-child').trigger('click');
	});


	// when clicking the toggle all details button show all in the containing div
	$('.btn-show-exp-details').on('click', function () {
	$('#accordion-details .panel-collapse').collapse('toggle');
	});

	// display circling busy button 
	$('button#btn-update').on('click', function() {
	var $this = $(this);
	var loadingText = '<i class="fa fa-circle-o-notch fa-spin"></i> Working...';
	if ($(this).html() !== loadingText) {
	    $this.data('original-text', $(this).html());
	    $this.html(loadingText);
	}
	setTimeout(function() {
            $this.html($this.data('original-text'));
	}, 30000);
	});

	// DASH publish button event handler
	function publishDASH_clickHandler(event) {
	   document.getElementById('action').value = "publishDASHProcess";
	   document.getElementById('publishDASH_form').submit();
	}

	// DASH reset button event handler
	function resetDASH_clickHandler(event) {
	   document.getElementById('action').value = "resetDASHProcess";
	   document.getElementById('publishDASH_form').submit();
	}

	// function for the bytes converter
	function formatBytes(a,b){if(0==a)return"0 Bytes";var c=1024,d=b||2,e=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],f=Math.floor(Math.log(a)/Math.log(c));return parseFloat((a/Math.pow(c,f)).toFixed(d))+" "+e[f]}


	// loop thru to check if any bytes need to be converted
	$('.bytes-convert').each(function(i, obj) {
	// get the val of byes
	var bytes = $(this).text();

	// get the id
	var bytesId = $(this).attr("id");

	// check if it is set and over 0
	if ( (bytes != "") && (bytes > 0) ) {
	// convert it
	bytesConverted = formatBytes(bytes);

	//console.log(bytesConverted);
	//console.log(bytesId);

	// convert and set it
	$("#" + bytesId).text("bytesConverted");
	}
	});
      </script>


      <script type="text/javascript" src="/expdb2.0/scripts/popitup.js"></script>

      <!-- js end -->
    </div>
  </body>
</html>

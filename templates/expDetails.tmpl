<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
        <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>
  <title>CESM2 Experiments Database</title>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
   <meta http-equiv="cache-control" content="max-age=0" />
   <meta http-equiv="cache-control" content="no-cache" />
   <meta http-equiv="expires" content="0" />
   <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
   <meta http-equiv="pragma" content="no-cache" />
   <meta name="description" content="CESM2 Experiments Database"/>
   <meta name="keywords"    content="CESM Software Engineering Working Group"/>

   <style type="text/css" media="screen">
     @import "/styles/cesm.css"; 
     @import "/styles/teststyles.css";
     @import "/svnuser/css/svnuser.css";
     @import "/jqueryui/development-bundle/demos/demos.css";
     @import "/jqueryui/css/redmond/jquery-ui-1.8.23.custom.css";
     @import "/jquerydt/DataTables-1.9.3/media/css/jquery.dataTables.css";
   </style>

   <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" />
   <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.1/css/responsive.dataTables.min.css" />

   <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
   <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
   <script type="text/javascript" src="/scripts/popitup.js"></script>
   <script type="text/javascript" src="/expdb2.0/scripts/exp_dashboard.js"></script>  
   <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
   <script src="https://cdn.datatables.net/responsive/2.2.1/js/dataTables.responsive.min.js"></script>

   <style>
      #details { 
      background-color: #c5edcb; 
      }
      .alert:hover {
      cursor: pointer;
      }
      table {
      width: 90%;
      }
      .dtr-details {
      width: 90%;
      }
      table.dataTable tbody.tbody-status td {
      padding: 0px;
      font-size: .9em
      }
   </style>

</head>

<body>
  <p>
    [% INCLUDE header.tmpl %]
  </p>

  <div class="body">
    <h1>[% case.casename.value %] - Experiment Detail</h1>

    <h2>CESM Case Working Title:</h2>
    <table>
      <tr>
	<td valign="top"><button onclick="return popitup('/expdb2.0/cgi-bin/caseTitle.cgi?case_id=[% case.case_id.value %]&action=update&expType_id=[% case.expType_id.value %]','height=200,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-pencil"></span></button></td>
	<td>[% case.title.value %]</td>
      </tr>
      <tr>
	<td colspan="2">
	  [% IF validstatus %]
	  <div id="msgbox" [% IF validstatus.status %] style="color:green" [% ELSE %] style="color:red" [% END %]>
	    [% validstatus.message %]
	  </div>
	</td>
      </tr>
    [% END %]
    </table>

    <br/>
    <a class="show-all-exp-details show-hide">show all</a>
    <br/>
    <br/>

    <div class="expDetail_accordion expDetail_applying">
      <div id="expDetail_accordion">

	[% IF expType.name == 'cmip6' %]
	<h3>[% case.expType_name.value %] Project Details</h3>
	<div id="expDetail_table">
	  <div class="left">
	    <table class="bordered">
	      <thead>
		<th colspan="2">CMIP6 Fields</th>
	      </thead>
	      <thead>
		<th>Field Name</th>		
		<th>Value</th>		
	      </thead>
	      [% FOREACH key IN project.keys.sort  %]
	      <tr>
		<td>[% key %]</td>
		<td>[% project.$key %]</td>
	      </tr>
	      [% END %]
	    </table>
	  </div>

	  <div class="right">
	    <table class="bordered">
	      <thead>
		<th colspan="2">CMIP6 File Global Attributes</th>
	      </thead>
	      <thead>
		<th>Field Name</th>		
		<th>Value</th>		
	      </thead>
	      [% FOREACH key IN globalAtts.keys.sort  %]
	      <tr>
		<td>[% key %]</td>
		<td>[% globalAtts.$key %]</td>
	      </tr>
	      [% END %]
	    </table>
	  </div>
	</div>
	[% END %]

	<h3>Case Workflow Process Status</h3>
	<div id="expDetail_table">
          <div style="text-align: center;" id="statusTable_buttons">
            <button id="statusBtn-show-all-children" class="btn btn-primary" type="button">Expand All</button>
            <button id="statusBtn-hide-all-children" class="btn btn-primary" type="button">Collapse All</button>
          </div>

	  <table id="statusTable" style="width: 100%">
	    <thead>
	      <tr>
		<th>Description</th>		
		<th>Process Name</th>		
		<th>Status</th>		
		<th>Model Date</th>		
		<th>Disk Path</th>		
		<th>Disk Usage</th>		
		<th>Last Update</th>		
		<th>Archive Method</th>
		<th class="none">Status History</th>
	      </tr>
	    </thead>
	    <tbody>
	      [% FOREACH key IN status.keys.sort %]
	      <tr>
		<td>[% status.$key.description %]</td>
		<td>[% key %]</td>
		<td style="background-color:[% status.$key.color %]">[% status.$key.code %]</td>
		<td><pre>[% status.$key.model_date %]</pre></td>
		<td>[% status.$key.disk_path %]</td>
		<td>[% status.$key.disk_usage %]</td>
		<td>[% status.$key.last_update %]</td>
		<td>[% status.$key.archive_method %]</td>
		<td>
		  <table>
		    <thead>
		      <tr id="details">
			<th>Status</th>		
			<th>Model Date</th>		
			<th>Disk Path</th>		
			<th>Disk Usage</th>		
			<th>Last Update</th>		
			<th>Archive Method</th>
		      </tr>
		    </thead>
		    <tbody class="tbody-status">
		      [% FOREACH stat IN status.$key.history %]
		      <tr class="tr-status">
			<td style="background-color:[% stat.color %]">[% stat.code %]</td>
			<td><pre>[% stat.model_date %]</pre></td>
			<td>[% stat.disk_path %]</td>
			<td>[% stat.disk_usage %]</td>
			<td>[% stat.last_update %]</td>
			<td>[% stat.archive_method %]</td>
		      </tr>
		      [% END %]
		    </tbody>
		  </table>
		</td>
	      </tr>
	      [% END %]
	    </tbody>
	    <tfoot>
	      <tr>
		<th>Description</th>		
		<th>Process Name</th>		
		<th>Status</th>		
		<th>Model Date</th>		
		<th>Disk Path</th>		
		<th>Disk Usage</th>		
		<th>Last Update</th>		
		<th>Archive Method</th>
		<th class="none">Status History</th>
	      </tr>
	    </tfoot>
	  </table>
	</div>

	<h3>Caseroot Settings</h3>
	<div id="expDetail_table">
          <div style="text-align: center;" id="caseTable_buttons">
            <button id="caseBtn-show-all-children" class="btn btn-primary" type="button">Expand All</button>
            <button id="caseBtn-hide-all-children" class="btn btn-primary" type="button">Collapse All</button>
          </div>

	  <table id="caseTable" style="width: 100%">
	    <thead>
	      <tr>
		<th>Case Field Name</th>		
		<th>Field Value</th>		
		<th class="none">Change History</th>		
	      </tr>
	    </thead>
	    <tbody>
	      [% FOREACH key IN case.keys.sort %]
	      <tr>
		<td>[% key %]</td>
		<td>[% case.$key.value %]</td>
		<td>
		  <table>
		    <thead>
		      <tr id="details">
			<th>Field Value</th>
			<th>Last Update</th>
		      </tr>
		    </thead>
		    <tbody>
		      [% FOREACH change IN case.$key.history %]
		      <tr>
			<td>[% change.field_value %]</td>
			<td>[% change.last_update %]</td>
		      </tr>
		      [% END %]
		    </tbody>
		  </table>
		</td>
	      </tr>
	      [% END %]
	    </tbody>
	    <tfoot>
	      <tr>
		<th>Case Field Name</th>		
		<th>Field Value</th>		
		<th class="none">Change History</th>		
	      </tr>
	    </tfoot>
	  </table>
	</div>

	<h3>Case Notes</h3>
	<div id="expDetail_table">
	  <table class="bordered">
	    <tr>
	      <td valign="top"> <button onclick="return popitup('/expdb2.0/cgi-bin/caseNotes.cgi?case_id=[% case.case_id %]&expType_id=[% case.expType_id %]','height=200,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-plus"></span></button> Case Notes:</td>
	      <td>
		<table>
		  <thead>
		    <th></th>		
		    <th>Note</th>		
		    <th>User</th>		
		    <th>Last Update</th>		
		  </thead>
		  [% FOREACH n IN notes %]
		  <tr>
		    <td valign="top"><button onclick="return popitup('/expdb2.0/cgi-bin/caseNotes.cgi?case_id=[% case.case_id %]&note_id=[% n.note_id %]&action=update&expType_id=[% case.expType_id %]','height=200,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-pencil"></span></button></td>
		    <td><pre>[% n.note %]</pre></td>
		    <td valign="top">[% n.firstname %] [% n.lastname %] ([% n.email %]) </td>
		    <td valign="top">[% n.last_update %]</td>
		  </tr>
		  [% END %]
		</table>
	      </td>
	    </tr>
	  </table>
	</div>

	<h3>Case Diagnostics and Climate Data Gateway Links</h3>
	<div id="expDetail_table">
	  <table class="bordered">
	    <tr>
	      <td valign="top"><button onclick="return popitup('/expdb2.0/cgi-bin/caseLinks.cgi?case_id=[% case.case_id %]&expType_id=[% case.expType_id %]','height=300,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-plus"></span></button> Case Links:</td>
	      <td>
		<table>
		  [% FOREACH lk IN links %]
		  <thead>
		    <th></th>
		    <th>Process</th>		
		    <th>Link Type</th>		
		    <th>Link</th>		
		    <th>Last Update</th>		
		  </thead>
		  <tr>
		    <td><button onclick="return popitup('/expdb2.0/cgi-bin/caseLinks.cgi?case_id=[% case.case_id %]&link_id=[% lk.link_id %]&action=update&expType_id=[% case.expType_id %]','height=300,width=800,scrollbars=yes')"><span class="ui-icon ui-icon-pencil"></span></button></td>
		    <td>[% lk.process_name %]</td>
		    <td>[% lk.linkType_name %]</td>
		    [% http = lk.link %]
		    [% IF lk.linkType_id == 1 %]
		    <td><a href="[% lk.link %]" target="_blank">[% lk.link %]</a></td>
		    [% ELSE %]
		    <td>[% lk.link %]</td>
		    [% END %]
		    <td>[% lk.last_update %]</td>
		  </tr>
		  <tr>
		    <td colspan="5"><b>Description</b></td>
		  </tr>
		  <tr>
		    <td colspan="5">[% lk.description %]</td>
		  </tr>
		  [% END %]
		</table>
	      </td>
	    </tr>
	  </table>
	</div>

	<h3>Publication Options</h3>
	<div id="expDetail_table">
	  <p>* You must be the scientific lead or archiver for this experiment or a expdb2.0 admin in order to publish. After successful publication, it is up to the user to delete any intermediate files associated with this experiment on disk. <b>These publication steps are coming soon!</b></p>

	  <form action="/expdb2.0/cgi-bin/publishGCD.cgi?case_id=[% case.case_id %]">
	    <p><input type="checkbox" name="gcd_cb" onclick="if(this.checked){this.form.submit()}"> Publish to NCAR Climate Data Gateway (formally ESG).</input> This publishes the single-variable CESM compressed timeseries netCDF files.</p>
	  </form>

	  <form action="/expdb2.0/cgi-bin/publishESGF.cgi?case_id=[% case.case_id %]">
	    <p><input type="checkbox" name="gcd_cb" onclick="if(this.checked){this.form.submit()}"> Publish to ESGF.</input> This publishes the Conformed compressed timeseries netCDF files.</p>
	  </form>

	  <form action="/expdb2.0/cgi-bin/publishDSET.cgi?case_id=[% case.case_id %]&expType_id=[% case.expType_id %]">
	    <p><input type="checkbox" name="dset_cb" onclick="if(this.checked){this.form.submit()}"> Publish Experiment to DASH.</input></p>
	  </form>

	  <form action="/expdb2.0/cgi-bin/publishScience.cgi?case_id=[% case.case_id %]">
	    <p><input type="checkbox" name="science_cb" onclick="if(this.checked){this.form.submit()}"> Publish to CESM Scientifically Validated web page.</input></p>
	  </form>

	  <form action="/expdb2.0/cgi-bin/publishScience.cgi?case_id=[% case.case_id %]">
	    <p><input type="checkbox" name="timing_cb" onclick="if(this.checked){this.form.submit()}"> Publish to CESM Timing web page.</input></p>
	  </form>
	</div>


      </div>
    </div>
  </div>
</body>
</html>

